<!--_______________________________________________________________________________________________________________________
	Name:			FormSummary.page
	Description:	Summary of answers to all relevant questions in a form
					
	Date         Version Author      		Summary of Changes 
	___________  _______ _________________	________________________________________________________________________________
	May 2018     1.0     Michael Witchalls	Initial Release 
________________________________________________________________________________________________________________________ -->  
<apex:page controller="FormSummaryController" standardStylesheets="false" showHeader="false" docType="html-5.0" action="{!checkLoggedInStatus}"> 

    <apex:composition template="Layout">
        <apex:define name="title">
            <title>{!form.short_title} Summary</title>
        </apex:define>
        <apex:define name="breadcrumbs">
            <div class="breadcrumbs">
                <ol>
					<apex:outputText rendered="{!NOT(ISBLANK(grant))}">
	                    <li>
		                    <apex:outputLink value="{!$Page.LCFGrants}">
		                    Grant Management
		                    <apex:param name="id" value="{!grant['Application__c']}"/>
		                    </apex:outputLink>
	                    </li>
					</apex:outputText> 
					<apex:outputText rendered="{!ISBLANK(grant)}"> 
	                    <li>
		                    <apex:outputLink value="{!IF(partnerUser,URLFOR($Action.Application__c.List,$ObjectType.Application__c),$Page.Applications)}">
		                    Applications
		                    </apex:outputLink>
	                    </li>
                    </apex:outputText>
                    <li aria-current="page">{!form.title}</li> 
                </ol>
            </div>
        </apex:define>
        
        <apex:define name="mainFullWidth">

            <a href="#" onclick="window.history.go(-1); return false;" class="link-back">Back</a>
			<apex:outputText rendered="{!NOT(ISBLANK(grant))}">
	            <h1 class="heading-xlarge">
	                <span class="heading-secondary">{!application['Name']}/{!grant['Name']}: {!application['Theme__c']}
	                	<span style="float:right">{!grant['Contact__r.Name']}</span>
	                </span>
	                {!form.title}
		            <span class="heading-secondary">
						<apex:outputText rendered="{!form.period_title_field!=null}">
							<br/>{!targetObject[form.period_title_field]}
						</apex:outputText>
					</span>					
	            </h1>
	        </apex:outputText>
			<apex:outputText rendered="{!ISBLANK(grant)}">
	            <h1 class="heading-xlarge">
	                <span class="heading-secondary">{!application['Name']}: {!application['Theme__c']}
	                	<span style="float:right">{!application['Contact__r.Name']}</span>
	                </span>
	                {!form.title}
	            </h1>
			</apex:outputText>

	        <apex:repeat value="{!form.sections}" var="section">
            <h1 class="heading-large">{!section.title}</h1>
                    
            <table class="sections">
                <tbody class="summary">
                    <apex:repeat value="{!section.validPages}" var="validPage">
                        <apex:pageBlock rendered="{!AND(validPage.title != null)}">
                            <tr>
                                <th class="heading-large" colspan="3" valign="top">{!validPage.title}</th>
                            </tr>
                        </apex:pageBlock>
                        <apex:repeat value="{!validPage.fields}" var="field">
                      		<apex:outputPanel rendered="{!field.isValid}">
                            <tr>
                                <th class="question" valign="top">{!field.label}</th> 
                                <td valign="top">
                                	<apex:outputField value="{!targetObject[field.identifier]}" rendered="{!field.isPercent==false}"/>
                                	<apex:outputText value="{0,number,##.#%}" rendered="{!field.isPercent==true}">
                                		<apex:param value="{!targetObject[field.identifier]/100}"/>
                                	</apex:outputText>
                                </td>
                            </tr>
                            </apex:outputPanel>
                        </apex:repeat>
                      	<apex:outputPanel rendered="{!validPage.filesField!=null}">
                            <tr>
                                <th class="question" valign="top">{!validPage.filesField.label}</th> 
                                <td valign="top"><apex:outputField value="{!targetObject[validPage.filesField.identifier]}"/></td>
                            </tr>
                        </apex:outputPanel>
                        <apex:repeat value="{!validPage.children.childRecs}" var="obj">
                            <apex:repeat value="{!validPage.children.childPages}" var="pg">
								<apex:pageBlock rendered="{!AND(pg.title != null,NOT(CONTAINS(pg.title,'{{index}}')))}">
								    <tr>
                                		<th class="heading-medium" colspan="3" valign="top">{!pg.title}</th>
								    </tr>
								</apex:pageBlock>
                                <apex:repeat value="{!pg.fields}" var="field">
                                    <tr>
                                        <th class="question" valign="top">{!field.label}</th>
                                        <td valign="top"><apex:outputField value="{!obj[field.identifier]}"/></td>
                                        <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                    </tr>
                                </apex:repeat>
                      			<apex:outputPanel rendered="{!pg.displayField!=null}">
                                    <tr>
                                        <th class="question" valign="top">{!pg.displayField.label}</th>
                                        <td valign="top"><apex:outputField value="{!obj[pg.displayField.identifier]}"/></td>
                                        <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                    </tr>
                      			</apex:outputPanel>
                            </apex:repeat>
                            <tr><td style="border-top:3px solid black" colspan="3"></td></tr>
                        </apex:repeat>
                        <apex:outputPanel rendered="{!validPage.children.total_field2!=null}">
                             <tr>
                                 <th class="question" valign="top">TOTAL {!validPage.children.field_head2}</th>
                                 <td valign="top"><apex:outputField value="{!targetObject[validPage.children.total_field2]}"/></td>
                                 <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                             </tr>
                        </apex:outputPanel>
                         <apex:outputPanel rendered="{!validPage.children.total_field3!=null}">
                             <tr>
                                 <th class="question" valign="top">TOTAL {!validPage.children.field_head3}</th>
                                 <td valign="top"><apex:outputField value="{!targetObject[validPage.children.total_field3]}"/></td>
                                 <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                             </tr>
                        </apex:outputPanel>
                         <apex:outputPanel rendered="{!validPage.children.total_field4!=null}">
                             <tr>
                                 <th class="question" valign="top">TOTAL {!validPage.children.field_head4}</th>
                                 <td valign="top"><apex:outputField value="{!targetObject[validPage.children.total_field4]}"/></td>
                                 <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                             </tr>
                        </apex:outputPanel>
                         <apex:outputPanel rendered="{!validPage.children.total_field5!=null}">
                             <tr>
                                 <th class="question" valign="top">TOTAL {!validPage.children.field_head5}</th>
                                 <td valign="top"><apex:outputField value="{!targetObject[validPage.children.total_field5]}"/></td>
                                 <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                             </tr>
                        </apex:outputPanel>
                         <apex:outputPanel rendered="{!validPage.children.total_field6!=null}">
                             <tr>
                                 <th class="question" valign="top">TOTAL {!validPage.children.field_head6}</th>
                                 <td valign="top"><apex:outputField value="{!targetObject[validPage.children.total_field6]}"/></td>
                                 <td class="numeric" valign="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                             </tr>
                        </apex:outputPanel>
                    </apex:repeat>
                </tbody>
            </table>
            <table class="sections">
                <tbody class="summary">
                    <tr><td style="border:none"></td></tr>
                    <tr>
                        <th class="question" valign="top">Section Status</th>
                        <td><span class="status">{!targetObject[section.status_field]}</span></td>
                     </tr>
                </tbody>
            </table>
            </apex:repeat>  
        </apex:define>
    </apex:composition>
</apex:page>